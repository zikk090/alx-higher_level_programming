This is a part of the sql that is getting tougher
